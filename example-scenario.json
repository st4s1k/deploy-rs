{
  "credentials": {
    "//": [
      "// username - will be added to the variables",
      "// password - if not provided, will use the ssh-agent"
    ],
    "username": "my_username",
    "password": "my_password"
  },
  "server": {
    "host": "localhost",
    "port": "22"
  },
  "execute": {
    "steps": [
      {
        "task": "copy_jar_to_server"
      },
      {
        "task": "stop_service",
        "rollback": [
          "start_service"
        ]
      },
      {
        "task": "create_backup",
        "rollback": [
          "start_service"
        ]
      },
      {
        "task": "remove_current_deploy",
        "rollback": [
          "restore_backup",
          "start_service"
        ]
      },
      {
        "task": "deploy_new_file",
        "rollback": [
          "restore_backup",
          "start_service"
        ]
      },
      {
        "task": "start_service",
        "rollback": [
          "restore_backup",
          "start_service"
        ]
      }
    ]
  },
  "variables": {
    "//": [
      "// required - If not provided in the code, the will be prompted for input",
      "// special - Special variables generated by the program",
      "// defined - plain string variables defined in the scenario",
      "//           [!] password - will not be added from the credentials,",
      "//                        - you must provide it at your own risk",
      "//                        - a field with this name will not be displayed in UI"
    ],
    "required": {
      "local_jar_path": "Local JAR Path",
      "local_jar_basename": "Local JAR Basename"
    },
    "special": {
      "timestamp": "%Y-%m-%dT%H%M%S%:z"
    },
    "defined": {
      "service_name": "my_service",
      "password": "my_password",
      "remote_service_script_path": "/usr/local/bin/{service_name}.sh",
      "remote_deploy_path": "/usr/local/{service_name}/{service_name}.jar",
      "backup_path": "/u01/backup/{service_name}/{service_name}-{timestamp}.jar",
      "remote_base_path": "/home/{username}"
    }
  },
  "tasks": {
    "copy_jar_to_server": {
      "type": "SftpCopy",
      "description": "Copying new deploy file to server",
      "source_path": "{local_jar_path}",
      "destination_path": "{remote_base_path}/{local_jar_basename}",
      "error_message": "Failed to copy new deploy file to server."
    },
    "stop_service": {
      "type": "RemoteSudo",
      "description": "Stopping the service on remote server",
      "command": "echo {password} | sudo -S {remote_service_script_path} stop",
      "error_message": "Failed to stop the service on the remote server."
    },
    "create_backup": {
      "type": "RemoteSudo",
      "description": "Creating backup of current deployment",
      "command": "echo {password} | sudo -S cp -a {remote_deploy_path} {backup_path}",
      "error_message": "Failed to create backup of the current deployment."
    },
    "remove_current_deploy": {
      "type": "RemoteSudo",
      "description": "Removing current deployment",
      "command": "echo {password} | sudo -S rm {remote_deploy_path} -f",
      "error_message": "Failed to remove the current deployment."
    },
    "deploy_new_file": {
      "type": "RemoteSudo",
      "description": "Deploying the new file",
      "command": "echo {password} | sudo -S mv {remote_base_path}/{local_jar_basename} {remote_deploy_path}",
      "error_message": "Failed to deploy the new file."
    },
    "start_service": {
      "type": "RemoteSudo",
      "description": "Starting the service on remote server",
      "command": "echo {password} | sudo -S {remote_service_script_path} start",
      "error_message": "Failed to start the service on the remote server."
    },
    "restore_backup": {
      "type": "RemoteSudo",
      "description": "Restoring backup of current deployment",
      "command": "echo {password} | sudo -S cp -a {backup_path} {remote_deploy_path}",
      "error_message": "Failed to restore backup of the current deployment."
    }
  }
}
